<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ALL IN THE MIND</title>

<style>
/* ===== SPACE THEME ===== */
body {
  font-family: Arial, sans-serif;
  background: radial-gradient(ellipse at bottom, #0d0d1a 0%, #000000 100%);
  color: #e0e0ff;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  transition: background 0.3s, color 0.3s;
  position: relative;
}

/* Floating stars canvas */
#space-canvas {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

h1, h2 {
  text-align: center;
  text-shadow: 0 0 10px #7f8cfa, 0 0 20px #3498db;
}

#members {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin: 10px 0 5px;
  width: 90%;
  max-width: 500px;
  z-index: 1;
  position: relative;
}

.member {
  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
  color: white;
  opacity: 0.8;
  transition: 0.2s;
  font-size: 0.9em;
  border: 1px solid rgba(255,255,255,0.2);
  text-shadow: 0 0 5px #000;
}

.member.active,
.member:hover {
  opacity: 1;
  font-weight: bold;
  transform: scale(1.05);
  box-shadow: 0 0 15px #3498db, 0 0 25px #9b59b6;
}

.member.meca { background: #9b59b6; }
.member.johny { background: #27ae60; }
.member.jerome { background: #2980b9; }
.member.carl { background: #7f8c8d; }
.member.shawn { background: #f1c40f; color: #333; }
.member.jomar { background: #d35400; }

#progress {
  margin-bottom: 15px;
  font-size: 0.9em;
}

#taskSection {
  width: 95%;
  max-width: 600px;
  background: rgba(10,10,30,0.9);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(50,50,100,0.5);
  margin-bottom: 40px;
  z-index: 1;
  position: relative;
}

#newTaskInput {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

#addTaskBtn {
  width: 100%;
  padding: 12px;
  background: linear-gradient(45deg,#3498db,#9b59b6);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

#addTaskBtn:hover {
  transform: scale(1.02);
}

ul#taskList {
  list-style: none;
  padding: 0;
  margin-top: 15px;
  z-index: 1;
  position: relative;
}

ul#taskList li {
  padding: 12px;
  background: rgba(20,20,40,0.8);
  border-radius: 8px;
  margin-bottom: 10px;
  transition: all 0.2s;
}

ul#taskList li.completed {
  background: rgba(0,50,0,0.6);
  color: #b8ffb8;
}

.task-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
}

.task-text {
  flex-grow: 1;
  margin-right: 10px;
}

.status {
  font-weight: bold;
  color: #27ae60;
  margin-right: 10px;
}

button.completeBtn {
  background: #27ae60;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}

button.deleteBtn {
  background: #e74c3c;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}

/* DARK MODE BUTTON */
#darkToggle {
  position: fixed;
  top: 12px;
  right: 12px;
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  opacity: 0.7;
  z-index: 2;
}
#darkToggle:hover { opacity: 1; }

#confetti-canvas {
  position: fixed;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9999;
}
</style>
</head>

<body>
<canvas id="space-canvas"></canvas>
<button id="darkToggle">üåô</button>

<h1>Team Task Tracker</h1>

<div id="members">
  <div class="member meca" data-member="Meca">Meca</div>
  <div class="member johny" data-member="Johny">Johny</div>
  <div class="member jerome" data-member="Jerome">Jerome</div>
  <div class="member carl" data-member="Carl">Carl</div>
  <div class="member shawn" data-member="Shawn">Shawn</div>
  <div class="member jomar" data-member="Jomar">Jomar</div>
</div>

<div id="progress"></div>

<section id="taskSection" style="display:none;">
  <h2 id="memberTitle"></h2>
  <input type="text" id="newTaskInput" placeholder="Enter new task..." />
  <button id="addTaskBtn">Add Task</button>
  <ul id="taskList"></ul>
</section>

<canvas id="confetti-canvas"></canvas>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<script>
// ====== Firebase setup ======
const firebaseConfig = {
  apiKey: "AIzaSyCtVN-UVUnzxbpkkMgGiNeuchhe5269qQM",
  authDomain: "teamtasktracker-d2c06.firebaseapp.com",
  projectId: "teamtasktracker-d2c06",
  storageBucket: "teamtasktracker-d2c06.firebasestorage.app",
  messagingSenderId: "1030000534391",
  appId: "1:1030000534391:web:9e7266bd8979b98351f772"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ====== Variables ======
let selectedMember = null;
let data = {};
const members = ["Meca","Johny","Jerome","Carl","Shawn","Jomar"];

const membersDiv = document.getElementById("members");
const taskSection = document.getElementById("taskSection");
const memberTitle = document.getElementById("memberTitle");
const newTaskInput = document.getElementById("newTaskInput");
const addTaskBtn = document.getElementById("addTaskBtn");
const taskList = document.getElementById("taskList");
const progressDiv = document.getElementById("progress");
const darkToggle = document.getElementById("darkToggle");

// ====== Dark mode toggle ======
darkToggle.onclick = () => {
  document.body.classList.toggle("dark");
  darkToggle.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
};

// ====== Confetti ======
function showConfetti() {
  const duration = 2000;
  const end = Date.now() + duration;
  (function frame() {
    confetti({ particleCount: 5, spread: 70, origin: { y: 0.6 },
      colors: ["#9b59b6","#3498db","#f1c40f","#e74c3c"] });
    if (Date.now() < end) requestAnimationFrame(frame);
  })();
}

// ====== Load and Save ======
async function loadAllTasks(){
  const snapshot = await db.collection("tasks").get();
  data = {};
  snapshot.forEach(doc => data[doc.id] = doc.data().tasks || []);
  members.forEach(m => { if(!data[m]) data[m]=[]; });
}

async function saveTasksForMember(member){
  await db.collection("tasks").doc(member).set({
    tasks: data[member]
  });
}

// ====== Render Members ======
function renderMembers(){
  [...membersDiv.children].forEach(div=>{
    div.classList.toggle("active", div.dataset.member === selectedMember);
  });
}

// ====== Render Progress ======
function renderProgress(){
  if(!selectedMember) {
    progressDiv.textContent = "";
    return;
  }
  const total = data[selectedMember].length;
  const completed = data[selectedMember].filter(t => t.completed).length;
  const percent = total ? Math.round((completed/total)*100) : 0;
  progressDiv.textContent = `Progress: ${completed}/${total} tasks completed (${percent}%)`;
}

// ====== Render Tasks (with Deadline Highlighting) ======
function renderTasks(){
  taskList.innerHTML="";
  if(!selectedMember){
    taskSection.style.display="none";
    return;
  }
  taskSection.style.display="block";
  memberTitle.textContent = selectedMember + "'s Tasks";
  renderProgress();

  const now = new Date();
  data[selectedMember].forEach((task,index)=>{
    const li = document.createElement("li");
    if(task.completed) li.classList.add("completed");

    const row = document.createElement("div");
    row.className="task-row";

    const text = document.createElement("span");
    text.textContent = task.text;
    text.className="task-text";
    row.appendChild(text);

    // ====== Deadline Highlighting ======
    if(task.deadline && !task.completed){
      const deadlineDate = new Date(task.deadline);
      if(deadlineDate < now) li.style.border = "2px solid red";
      else if(deadlineDate.toDateString() === now.toDateString()) li.style.border = "2px solid orange";
    }

    if(task.completed){
      const status = document.createElement("span");
      status.textContent="COMPLETED";
      status.className="status";
      row.appendChild(status);
    } else {
      const completeBtn = document.createElement("button");
      completeBtn.textContent="Complete";
      completeBtn.className="completeBtn";
      completeBtn.onclick = async ()=>{
        task.completed = true;
        await saveTasksForMember(selectedMember);
        renderTasks();
        showConfetti();
      };
      row.appendChild(completeBtn);
    }

    const deleteBtn = document.createElement("button");
    deleteBtn.textContent="Remove";
    deleteBtn.className="deleteBtn";
    deleteBtn.onclick = async ()=>{
      data[selectedMember].splice(index,1);
      await saveTasksForMember(selectedMember);
      renderTasks();
    };

    row.appendChild(deleteBtn);
    li.appendChild(row);
    taskList.appendChild(li);
  });
}

// ====== Add Task ======
addTaskBtn.onclick = async ()=>{
  const text = newTaskInput.value.trim();
  if(!text) return;
  data[selectedMember].push({ text, completed:false });
  newTaskInput.value="";
  await saveTasksForMember(selectedMember);
  renderTasks();
};

// ====== Member Selection ======
membersDiv.onclick = async (e)=>{
  if(!e.target.classList.contains("member")) return;
  selectedMember = e.target.dataset.member;
  await loadAllTasks();
  renderMembers();
  renderTasks();
};

// ====== Load on start ======
window.onload = loadAllTasks;

// ====== Space Stars Background ======
const canvas = document.getElementById('space-canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let stars = [];
for(let i=0;i<150;i++){
  stars.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*1.2, dx:(Math.random()-0.5)*0.2, dy:(Math.random()-0.5)*0.2 });
}

function drawStars(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  stars.forEach(s=>{
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fillStyle = "white";
    ctx.fill();
    s.x+=s.dx; s.y+=s.dy;
    if(s.x<0)s.x=canvas.width;
    if(s.x>canvas.width)s.x=0;
    if(s.y<0)s.y=canvas.height;
    if(s.y>canvas.height)s.y=0;
  });
  requestAnimationFrame(drawStars);
}
drawStars();

window.addEventListener('resize',()=>{ canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
</script>

</body>
</html>
