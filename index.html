<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ALL IN THE MIND</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f7f7;
    margin: 0; 
    padding: 0;
    display: flex; 
    flex-direction: column; 
    align-items: center;
    min-height: 100vh;
  }

  h1 {
    margin: 30px 0 10px 0;
    font-size: 1.8em;
    text-align: center;
    color: #2c3e50;
  }

  #members {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin: 10px 0 20px 0;
    width: 90%;
    max-width: 500px;
  }

  .member {
    flex: 1 1 auto;
    text-align: center;
    padding: 10px 14px;
    border-radius: 8px;
    cursor: pointer;
    color: white;
    user-select: none;
    opacity: 0.8;
    transition: opacity 0.3s, transform 0.2s;
    font-size: 0.9em;
  }
  .member.active, .member:hover {
    opacity: 1;
    font-weight: bold;
    transform: scale(1.05);
  }

  /* Member colors */
  .member.meca { background: #9b59b6; }
  .member.johny { background: #27ae60; }
  .member.jerome { background: #2980b9; }
  .member.carl { background: #7f8c8d; }
  .member.shawn { background: #f1c40f; color: #333; }
  .member.jomar { background: #d35400; }

  #taskSection {
    width: 95%;
    max-width: 600px;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-bottom: 40px;
  }

  #taskSection h2 {
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 1.4em;
    text-align: center;
    color: #34495e;
  }

  #newTaskInput {
    width: 100%;
    padding: 12px;
    font-size: 1em;
    border: 1px solid #ccc;
    border-radius: 8px;
    margin-bottom: 12px;
  }

  #addTaskBtn {
    width: 100%;
    padding: 12px;
    font-size: 1em;
    cursor: pointer;
    border: none;
    background-color: #3498db;
    color: white;
    border-radius: 8px;
    transition: background-color 0.3s;
    margin-bottom: 15px;
  }

  #addTaskBtn:hover { background-color: #2980b9; }

  ul#taskList { list-style: none; padding: 0; margin-top: 0; }

  ul#taskList li {
    padding: 12px;
    margin-bottom: 10px;
    background: #ecf0f1;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    color: #333;
  }

  ul#taskList li.completed { background: #d5f5e3; color: #27ae60; font-weight: bold; }

  .task-row { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }

  .task-text { flex-grow: 1; margin-right: 10px; word-wrap: break-word; }

  .timestamp { font-size: 0.75em; color: #7f8c8d; margin-top: 4px; }

  button.completeBtn, button.deleteBtn {
    padding: 8px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85em;
    margin-top: 6px;
    transition: background-color 0.3s;
  }
  button.completeBtn { background: #27ae60; color: white; }
  button.completeBtn:hover { background: #1e8449; }
  button.deleteBtn { background: #e74c3c; color: white; }
  button.deleteBtn:hover { background: #c0392b; }

  #confetti-canvas {
    position: fixed; pointer-events: none; top: 0; left: 0;
    width: 100%; height: 100%; z-index: 9999;
  }

  @media(max-width: 480px){
    h1{ font-size: 1.5em; margin:20px 0; }
    #taskSection{ padding: 15px; }
    #newTaskInput,#addTaskBtn{ font-size:0.95em; padding: 10px; }
    button.completeBtn,button.deleteBtn{ font-size:0.8em; padding:6px 8px; margin-top:4px; }
  }
</style>
</head>
<body>

<h1>Team Task Tracker</h1>

<div id="members">
  <div class="member meca" data-member="Meca">Meca</div>
  <div class="member johny" data-member="Johny">Johny</div>
  <div class="member jerome" data-member="Jerome">Jerome</div>
  <div class="member carl" data-member="Carl">Carl</div>
  <div class="member shawn" data-member="Shawn">Shawn</div>
  <div class="member jomar" data-member="Jomar">Jomar</div>
</div>

<section id="taskSection" style="display:none;">
  <h2 id="memberTitle"></h2>
  <input type="text" id="newTaskInput" placeholder="Enter new task..." />
  <button id="addTaskBtn">Add Task</button>
  <ul id="taskList"></ul>
</section>

<canvas id="confetti-canvas"></canvas>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
// ===== Firebase config =====
const firebaseConfig = {
  apiKey: "AIzaSyCtVN-UVUnzxbpkkMgGiNeuchhe5269qQM",
  authDomain: "teamtasktracker-d2c06.firebaseapp.com",
  projectId: "teamtasktracker-d2c06",
  storageBucket: "teamtasktracker-d2c06.firebasestorage.app",
  messagingSenderId: "1030000534391",
  appId: "1:1030000534391:web:9e7266bd8979b98351f772"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let selectedMember = null;
let data = {};
const members = ["Meca","Johny","Jerome","Carl","Shawn","Jomar"];

const membersDiv = document.getElementById("members");
const taskSection = document.getElementById("taskSection");
const memberTitle = document.getElementById("memberTitle");
const newTaskInput = document.getElementById("newTaskInput");
const addTaskBtn = document.getElementById("addTaskBtn");
const taskList = document.getElementById("taskList");

function showConfetti() {
  const duration = 3*1000;
  const end = Date.now()+duration;
  (function frame(){
    confetti({ particleCount:5, spread:70, origin:{y:0.6} });
    if(Date.now()<end) requestAnimationFrame(frame);
  })();
}

async function loadAllTasks(){
  const snapshot = await db.collection("tasks").get();
  data={};
  snapshot.forEach(doc=> data[doc.id]=doc.data().tasks || []);
  members.forEach(m=> { if(!data[m]) data[m]=[]; });
}

async function saveTasksForMember(member){
  if(!member) return;
  await db.collection("tasks").doc(member).set({ tasks:data[member]||[] });
}

function renderMembers(){
  Array.from(membersDiv.children).forEach(div=>{
    div.classList.toggle("active", div.dataset.member===selectedMember);
  });
}

function formatTimestamp(ts){
  if(!ts) return "-";
  const d = ts.toDate();
  return d.toLocaleString();
}

function renderTasks(){
  taskList.innerHTML="";
  if(!selectedMember){ taskSection.style.display="none"; return; }
  taskSection.style.display="block";
  memberTitle.textContent = selectedMember+"'s Tasks";

  const tasks = data[selectedMember]||[];
  tasks.forEach((task,index)=>{
    const li = document.createElement("li");
    li.className = task.completed?"completed":"";
    const row = document.createElement("div"); row.className="task-row";
    const spanText = document.createElement("span"); spanText.textContent=task.text; spanText.className="task-text"; row.appendChild(spanText);

    const tsDiv = document.createElement("div"); tsDiv.className="timestamp";
    tsDiv.textContent = `Added: ${formatTimestamp(task.createdAt)} Completed: ${formatTimestamp(task.completedAt)}`;
    li.appendChild(row); li.appendChild(tsDiv);

    if(!task.completed){
      const completeBtn = document.createElement("button"); completeBtn.textContent="Complete"; completeBtn.className="completeBtn";
      completeBtn.onclick = async()=>{
        data[selectedMember][index].completed=true;
        data[selectedMember][index].completedAt = firebase.firestore.FieldValue.serverTimestamp();
        await saveTasksForMember(selectedMember);
        renderTasks(); showConfetti();
      };
      row.appendChild(completeBtn);
    }

    const deleteBtn = document.createElement("button"); deleteBtn.textContent="Remove"; deleteBtn.className="deleteBtn";
    deleteBtn.onclick = async()=>{
      data[selectedMember].splice(index,1);
      await saveTasksForMember(selectedMember);
      renderTasks();
    };
    row.appendChild(deleteBtn);

    taskList.appendChild(li);
  });
}

addTaskBtn.addEventListener("click", async ()=>{
  const taskText = newTaskInput.value.trim(); if(!taskText) return;
  data[selectedMember].push({text:taskText, completed:false, createdAt:firebase.firestore.FieldValue.serverTimestamp(), completedAt:null});
  newTaskInput.value="";
  await saveTasksForMember(selectedMember);
  renderTasks();
});

membersDiv.addEventListener("click", async e=>{
  if(!e.target.classList.contains("member")) return;
  selectedMember=e.target.dataset.member;
  await loadAllTasks(); renderMembers(); renderTasks();
});

window.addEventListener("load", async ()=>{ await loadAllTasks(); });
</script>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
</body>
</html>
