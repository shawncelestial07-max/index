<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TASK TRACKER</title>

<style>
:root{
  --bg:#f4f6fb;
  --card:#fff;
  --text:#2c2c2c;
  --muted:#6c6c6c;
  --blue:#2d6cdf;
  --green:#2ecc71;
  --red:#e74c3c;
  --shadow:rgba(0,0,0,0.08);
}

*{box-sizing:border-box;}
body{
  font-family:Inter, Arial, sans-serif;
  background:var(--bg);
  margin:0;
}

/* ================= ENTRY PAGE ================= */
#entry{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.entryBox{
  background:#fff;
  padding:30px;
  border-radius:16px;
  width:320px;
  box-shadow:0 10px 25px var(--shadow);
}

.entryBox h1{
  text-align:center;
  margin-bottom:20px;
}

.entryBox input{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:10px;
  border:1px solid #ddd;
}

.entryBox button{
  width:100%;
  padding:10px;
  border:none;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}

#adminLoginBtn{background:var(--blue); color:#fff;}
#memberEnter{background:#555; color:#fff; margin-top:10px;}

/* ================= APP ================= */
#app{display:none;}

.header{
  display:flex;
  justify-content:space-between;
  padding:18px 24px;
  background:#fff;
  box-shadow:0 2px 10px var(--shadow);
}

.container{
  display:grid;
  grid-template-columns:280px 1fr;
  gap:18px;
  padding:20px;
}

.sidebar{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow:0 10px 25px var(--shadow);
}

.member{
  padding:10px;
  margin-bottom:8px;
  border-radius:12px;
  background:#fafafa;
  cursor:pointer;
  font-weight:600;
}

.member.active{background:var(--blue); color:#fff;}

.main{
  display:flex;
  flex-direction:column;
  gap:18px;
}

.card{
  background:#fff;
  border-radius:16px;
  padding:18px;
  box-shadow:0 10px 25px var(--shadow);
}

#taskInputSection{display:none;}

#newTaskInput{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
  margin-bottom:8px;
}

#addTaskBtn{
  width:100%;
  padding:10px;
  border:none;
  border-radius:10px;
  background:var(--blue);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}

ul{list-style:none; padding:0;}
li{
  background:#fafafa;
  padding:10px;
  border-radius:10px;
  margin-bottom:8px;
}

button.smallBtn{
  padding:6px 10px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
}

.completeBtn{background:var(--green); color:#fff;}
.deleteBtn{background:var(--red); color:#fff;}

#backBtn{
  display:none;
  margin-top:10px;
  background:#777;
  color:#fff;
  padding:10px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- ================= ENTRY ================= -->
<div id="entry">
  <div class="entryBox">
    <h1>Task Tracker</h1>
    <input id="email" type="email" placeholder="Admin Email">
    <input id="password" type="password" placeholder="Password">
    <button id="adminLoginBtn">Admin Login</button>
    <button id="memberEnter">Member</button>
  </div>
</div>

<!-- ================= APP ================= -->
<div id="app">
  <header class="header">
    <strong>TASK TRACKER</strong>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </header>

  <main class="container">
    <aside class="sidebar" id="sidebar">
      <h3>Members</h3>
      <div id="members"></div>
    </aside>

    <section class="main">
      <div class="card">
        <h2 id="memberTitle"></h2>
        <div id="progress"></div>

        <div id="taskInputSection">
          <input id="newTaskInput" placeholder="Enter new task">
          <button id="addTaskBtn">Add Task</button>
        </div>

        <ul id="taskList"></ul>
        <button id="backBtn">Back</button>
      </div>
    </section>
  </main>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCtVN-UVUnzxbpkkMgGiNeuchhe5269qQM",
  authDomain:"teamtasktracker-d2c06.firebaseapp.com",
  projectId:"teamtasktracker-d2c06"
});

const db = firebase.firestore();
const auth = firebase.auth();

const members = ["Meca","Johny","Jerome","Carl","Shawn","Jomar","Yvone"];
let selectedMember = null;
let data = {};
let isAdmin = false;

/* ENTRY */
const entry = document.getElementById("entry");
const app = document.getElementById("app");
const memberEnter = document.getElementById("memberEnter");
const adminLoginBtn = document.getElementById("adminLoginBtn");
const logoutBtn = document.getElementById("logoutBtn");

/* DOM */
const membersDiv = document.getElementById("members");
const memberTitle = document.getElementById("memberTitle");
const taskInputSection = document.getElementById("taskInputSection");
const newTaskInput = document.getElementById("newTaskInput");
const addTaskBtn = document.getElementById("addTaskBtn");
const taskList = document.getElementById("taskList");
const backBtn = document.getElementById("backBtn");

/* ENTRY LOGIC */
memberEnter.onclick = () => {
  entry.style.display="none";
  app.style.display="block";
  setupRealtime();
};

adminLoginBtn.onclick = () => {
  auth.signInWithEmailAndPassword(
    email.value.trim(),
    password.value.trim()
  ).catch(e=>alert(e.message));
};

logoutBtn.onclick = () => auth.signOut();

auth.onAuthStateChanged(async user=>{
  if(!user) return;
  const token = await user.getIdTokenResult();
  if(token.claims.admin){
    isAdmin = true;
    logoutBtn.style.display="block";
    entry.style.display="none";
    app.style.display="block";
    setupRealtime();
  }
});

/* REALTIME */
function setupRealtime(){
  db.collection("tasks").onSnapshot(snap=>{
    data = {};
    snap.forEach(d=>data[d.id]=d.data().tasks||[]);
    members.forEach(m=>{if(!data[m])data[m]=[]});
    renderMembers();
  });
}

/* MEMBERS */
function renderMembers(){
  membersDiv.innerHTML="";
  members.forEach(m=>{
    const div=document.createElement("div");
    div.className="member"+(m===selectedMember?" active":"");
    div.textContent=m;
    div.onclick=()=>{
      selectedMember=m;
      renderTasks();
      taskInputSection.style.display="block";
      backBtn.style.display="block";
    };
    membersDiv.appendChild(div);
  });
}

/* TASKS */
function renderTasks(){
  memberTitle.textContent = selectedMember+"'s Tasks";
  taskList.innerHTML="";
  data[selectedMember].forEach((t,i)=>{
    const li=document.createElement("li");
    li.textContent=t.text;
    const btn=document.createElement("button");
    btn.className="smallBtn deleteBtn";
    btn.textContent="Remove";
    btn.onclick=()=>{
      if(!isAdmin)return alert("Admin only");
      data[selectedMember].splice(i,1);
      save();
    };
    li.appendChild(btn);
    taskList.appendChild(li);
  });
}

addTaskBtn.onclick=()=>{
  if(!isAdmin)return alert("Admin only");
  data[selectedMember].push({text:newTaskInput.value,completed:false});
  newTaskInput.value="";
  save();
};

function save(){
  db.collection("tasks").doc(selectedMember).set({tasks:data[selectedMember]});
}

/* BACK */
backBtn.onclick=()=>{
  selectedMember=null;
  memberTitle.textContent="";
  taskList.innerHTML="";
  taskInputSection.style.display="none";
  backBtn.style.display="none";
  renderMembers();
};
</script>
</body>
</html>
