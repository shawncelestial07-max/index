<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TASK TRACKER</title>

<style>
/* ===== SIMPLE AESTHETIC THEME ===== */
:root {
  --bg: #f4f6fb;
  --card: #ffffff;
  --text: #2c2c2c;
  --muted: #666;
  --blue: #2d6cdf;
  --green: #2ecc71;
  --red: #e74c3c;
  --shadow: rgba(0,0,0,0.08);
}

body {
  font-family: "Inter", Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

h1, h2 {
  text-align: center;
  font-weight: 700;
  margin: 12px 0;
}

/* ===== MEMBERS ===== */
#members {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin: 15px 0;
  width: 90%;
  max-width: 520px;
}

.member {
  padding: 10px 16px;
  border-radius: 12px;
  cursor: pointer;
  font-size: 0.9em;
  background: var(--card);
  border: 1px solid #e0e0e0;
  transition: 0.2s ease;
  display: flex;
  align-items: center;
  gap: 6px;
}

.member:hover {
  transform: translateY(-2px);
}

.member.active {
  background: var(--blue);
  color: white;
  border-color: var(--blue);
}

/* Small pending count */
.badge {
  font-size: 0.7em;
  padding: 2px 6px;
  border-radius: 10px;
  background: #f1c40f;
  color: #333;
  font-weight: 600;
}

/* ===== PROGRESS ===== */
#progress {
  font-size: 0.9em;
  margin-bottom: 10px;
  color: var(--muted);
}

/* ===== TASK SECTION ===== */
#taskSection {
  width: 95%;
  max-width: 600px;
  background: var(--card);
  padding: 22px;
  border-radius: 16px;
  box-shadow: 0 10px 25px var(--shadow);
  margin-bottom: 40px;
}

/* Fixing input margin to be even */
#newTaskInput {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
  box-sizing: border-box;
}

#addTaskBtn {
  width: 100%;
  padding: 12px;
  background: var(--blue);
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}

/* ===== TASK LIST ===== */
ul#taskList {
  list-style: none;
  padding: 0;
  margin-top: 15px;
}

ul#taskList li {
  padding: 14px;
  background: #f9f9f9;
  border-radius: 12px;
  margin-bottom: 10px;
  border: 1px solid #eee;
}

ul#taskList li.completed {
  background: #e9f7ef;
  color: #2e7d32;
}

.task-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
}

.task-text {
  flex-grow: 1;
  margin-right: 10px;
}

/* Small date info */
.task-info {
  font-size: 0.75em;
  color: var(--muted);
  margin-top: 6px;
  width: 100%;
}

/* Status labels */
.status {
  font-size: 0.75em;
  font-weight: 700;
  margin-right: 10px;
}

.status.completed {
  color: var(--green);
}

.status.pending {
  color: #f1c40f;
}

.pastdue {
  color: var(--red);
  font-weight: 800;
  font-size: 0.75em;
  margin-left: 8px;
}

button.completeBtn {
  background: var(--green);
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  margin-right: 8px;
}

button.deleteBtn {
  background: var(--red);
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
}

/* ===== LOGIN SECTION ===== */
#loginSection {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 6px;
  align-items: center;
}

#loginSection input {
  padding: 8px;
  width: 130px;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 12px;
}

#loginSection button {
  padding: 8px 10px;
  border-radius: 8px;
  border: none;
  background: var(--blue);
  color: white;
  cursor: pointer;
  font-size: 12px;
}

/* ===== DARK MODE ===== */
#darkToggle {
  position: fixed;
  top: 14px;
  right: 14px;
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
}

/* ===== DARK MODE STYLES ===== */
body.dark {
  background: #121212;
  color: #f1f1f1;
}

body.dark #taskSection,
body.dark .member {
  background: #1e1e1e;
  border-color: #333;
}

body.dark ul#taskList li {
  background: #2a2a2a;
  border-color: #333;
}

body.dark #newTaskInput {
  background: #2a2a2a;
  color: #f1f1f1;
  border-color: #444;
}

body.dark .member.active {
  background: #2d6cdf;
  color: white;
}

/* ===== POPUP ===== */
#popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
}

#popupBox {
  background: #fff;
  padding: 20px;
  border-radius: 14px;
  width: 90%;
  max-width: 360px;
  text-align: center;
}

#popupBox input {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
  margin-top: 10px;
}

#popupBox button {
  margin-top: 12px;
  padding: 10px 16px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}

#popupOk {
  background: var(--blue);
  color: white;
}

#popupCancel {
  background: var(--red);
  color: white;
}
</style>
</head>

<body>

<button id="darkToggle">üåô</button>

<h1>TASK TRACKER</h1>

<div id="members">
  <div class="member" data-member="Meca">Meca</div>
  <div class="member" data-member="Johny">Johny</div>
  <div class="member" data-member="Jerome">Jerome</div>
  <div class="member" data-member="Carl">Carl</div>
  <div class="member" data-member="Shawn">Shawn</div>
  <div class="member" data-member="Jomar">Jomar</div>
  <div class="member" data-member="Yvone">Yvone</div>
</div>

<div id="progress"></div>

<section id="taskSection" style="display:none;">
  <h2 id="memberTitle"></h2>
  <input type="text" id="newTaskInput" placeholder="Enter new task..." />
  <button id="addTaskBtn">Add Task</button>
  <ul id="taskList"></ul>
</section>

<div id="popup">
  <div id="popupBox">
    <div style="font-weight:700; font-size:16px;">Set Schedule</div>
    <input type="date" id="popupDate" />
    <button id="popupOk">Save</button>
    <button id="popupCancel">Cancel</button>
  </div>
</div>

<div id="loginSection">
  <span style="font-size:12px; font-weight:700;">ADMIN</span>
  <input id="email" type="email" placeholder="Email" />
  <input id="password" type="password" placeholder="Password" />
  <button id="loginBtn">Login</button>
  <button id="logoutBtn" style="display:none;">Logout</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<script>
 // ===== Firebase =====
 firebase.initializeApp({
   apiKey: "AIzaSyCtVN-UVUnzxbpkkMgGiNeuchhe5269qQM",
   authDomain: "teamtasktracker-d2c06.firebaseapp.com",
   projectId: "teamtasktracker-d2c06"
 });
 const db = firebase.firestore();
 const auth = firebase.auth();

 // ===== Variables =====
 let selectedMember = null;
 let data = {};
 const members = ["Meca","Johny","Jerome","Carl","Shawn","Jomar","Yvone"];

 const membersDiv = document.getElementById("members");
 const taskSection = document.getElementById("taskSection");
 const memberTitle = document.getElementById("memberTitle");
 const newTaskInput = document.getElementById("newTaskInput");
 const addTaskBtn = document.getElementById("addTaskBtn");
 const taskList = document.getElementById("taskList");
 const progressDiv = document.getElementById("progress");

 // Popup
 const popup = document.getElementById("popup");
 const popupDate = document.getElementById("popupDate");
 const popupOk = document.getElementById("popupOk");
 const popupCancel = document.getElementById("popupCancel");

 const emailInput = document.getElementById("email");
 const passInput = document.getElementById("password");
 const loginBtn = document.getElementById("loginBtn");
 const logoutBtn = document.getElementById("logoutBtn");

 // ===== Dark Mode Toggle (FIXED) =====
 const darkToggle = document.getElementById("darkToggle");

 if (localStorage.getItem("darkMode") === "true") {
   document.body.classList.add("dark");
   darkToggle.textContent = "‚òÄÔ∏è";
 }

 darkToggle.onclick = () => {
   document.body.classList.toggle("dark");
   const isDark = document.body.classList.contains("dark");
   localStorage.setItem("darkMode", isDark);
   darkToggle.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
 };

 // ===== Auth Login =====
 loginBtn.onclick = () => {
   const email = emailInput.value.trim();
   const pass = passInput.value.trim();
   if (!email || !pass) return alert("Enter email & password");

   auth.signInWithEmailAndPassword(email, pass)
     .then(() => {
       emailInput.value = "";
       passInput.value = "";
     })
     .catch(err => alert(err.message));
 };

 logoutBtn.onclick = () => auth.signOut();

 // ===== Auth State =====
 auth.onAuthStateChanged(async user => {
   if (!user) {
     addTaskBtn.disabled = true;
     logoutBtn.style.display = "none";
     loginBtn.style.display = "block";
     emailInput.style.display = "inline-block";
     passInput.style.display = "inline-block";
     return;
   }

   const token = await user.getIdTokenResult();
   const isAdmin = token.claims.admin;

   // admin sees add/remove
   addTaskBtn.disabled = !isAdmin;

   // hide login if signed in
   loginBtn.style.display = "none";
   emailInput.style.display = "none";
   passInput.style.display = "none";
   logoutBtn.style.display = "inline-block";
 });

 // ===== Load / Save =====
 async function loadAllTasks(){
   const snap = await db.collection("tasks").get();
   data = {};
   snap.forEach(d => data[d.id] = d.data().tasks || []);
   members.forEach(m => { if(!data[m]) data[m] = []; });
   renderMembers();
 }

 async function saveTasksForMember(member){
   await db.collection("tasks").doc(member).set({ tasks: data[member] });
   renderMembers();
 }

 // ===== Render Members (with pending count) =====
 function renderMembers(){
   [...membersDiv.children].forEach(div => {
     const name = div.dataset.member;
     div.classList.toggle("active", name === selectedMember);

     const pending = data[name]?.filter(t => !t.completed).length || 0;
     div.innerHTML = name + (pending ? ` <span class="badge">${pending}</span>` : "");
   });
 }

 // ===== Progress =====
 function renderProgress(){
   if(!selectedMember) return progressDiv.textContent="";
   const total = data[selectedMember].length;
   const completed = data[selectedMember].filter(t=>t.completed).length;
   const percent = total ? Math.round(completed/total*100) : 0;
   progressDiv.textContent = `Progress: ${completed}/${total} (${percent}%)`;
 }

 // ===== Render Tasks =====
 function renderTasks(){
   taskList.innerHTML = "";
   if(!selectedMember) return taskSection.style.display="none";
   taskSection.style.display="block";
   memberTitle.textContent = selectedMember + "'s Tasks";
   renderProgress();

   data[selectedMember].forEach((task,i)=>{
     const li = document.createElement("li");
     if(task.completed) li.classList.add("completed");

     const row = document.createElement("div");
     row.className = "task-row";

     const text = document.createElement("span");
     text.className = "task-text";

     // completed check icon
     if(task.completed){
       text.innerHTML = "‚úîÔ∏è " + task.text;
     } else {
       text.textContent = task.text;
     }

     row.appendChild(text);

     // Small date info
     const info = document.createElement("div");
     info.className = "task-info";
     const created = task.createdAt ? new Date(task.createdAt).toLocaleString() : "No timestamp";

     let dueText = "No due date";
     let dueColor = "#666";
     let overdueLabel = "";

     if (task.dueDate) {
       const dueDateObj = new Date(task.dueDate);
       const today = new Date();
       today.setHours(0,0,0,0);

       dueText = dueDateObj.toLocaleDateString();

       if (!task.completed && dueDateObj < today) {
         dueColor = "#e74c3c"; // red
         overdueLabel = "PAST DUE";
       }
     }

     info.textContent = `Created: ${created} ‚Ä¢ Due: ${dueText}`;
     info.style.color = dueColor;
     row.appendChild(info);

     const status = document.createElement("span");
     status.className = "status " + (task.completed ? "completed" : "pending");
     status.textContent = task.completed ? "COMPLETED" : "PENDING";

     row.appendChild(status);

     if(overdueLabel){
       const pastDue = document.createElement("span");
       pastDue.className = "pastdue";
       pastDue.textContent = overdueLabel;
       row.appendChild(pastDue);
     }

     // ‚úî Anyone can complete (button above Remove)
     if(!task.completed){
       const completeBtn = document.createElement("button");
       completeBtn.className="completeBtn";
       completeBtn.textContent="Complete";
       completeBtn.onclick = async ()=>{
         task.completed = true;
         await saveTasksForMember(selectedMember);
         renderTasks();
         confetti();
       };
       row.appendChild(completeBtn);
     }

     // ‚ùå Admin only delete
     const deleteBtn = document.createElement("button");
     deleteBtn.className="deleteBtn";
     deleteBtn.textContent="Remove";
     deleteBtn.onclick = async ()=>{
       const user = auth.currentUser;
       if (!user) return alert("Admin only");

       const token = await user.getIdTokenResult();
       if (!token.claims.admin) return alert("Admin only");

       data[selectedMember].splice(i,1);
       await saveTasksForMember(selectedMember);
       renderTasks();
     };

     row.appendChild(deleteBtn);
     li.appendChild(row);
     taskList.appendChild(li);
   });
 }

 // ===== Add Task =====
 addTaskBtn.onclick = async ()=>{
   const user = auth.currentUser;
   if (!user) return alert("Admin only");

   const token = await user.getIdTokenResult();
   if (!token.claims.admin) return alert("Admin only");

   if(!newTaskInput.value.trim()) return;

   // open popup for due date
   popup.style.display = "flex";
 };

 // ===== Popup actions =====
 popupOk.onclick = async () => {
   const dueDate = popupDate.value;

   data[selectedMember].push({
     text: newTaskInput.value,
     completed: false,
     createdAt: Date.now(),
     dueDate: dueDate
   });

   newTaskInput.value = "";
   popupDate.value = "";
   popup.style.display = "none";

   await saveTasksForMember(selectedMember);
   renderTasks();
 };

 popupCancel.onclick = () => {
   popup.style.display = "none";
 };

 // ===== Select Member =====
 membersDiv.onclick = async e=>{
   if(!e.target.closest(".member")) return;
   selectedMember = e.target.closest(".member").dataset.member;
   await loadAllTasks();
   renderTasks();
 };

 window.onload = loadAllTasks;
</script>

</body>
</html>
